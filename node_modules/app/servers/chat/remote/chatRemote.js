var roomDao = require('../../../dao/roomDao');
var userDao = require('../../../dao/userDao');
var async = require('async');

module.exports = function(app) {
	return new ChatRemote(app);
};

var ChatRemote = function(app) {
	this.app = app;
};

ChatRemote.prototype.create = function(uid, roomname, callback) {
	var roomData;
	async.waterfall([
		function(cb) {
			roomDao.create(uid,roomname,function(err, data){
				cb(err);
			});
		},
		function(cb) {
			roomDao.join(uid,roomname,function(err, data){
				roomData = data;
				cb(err);
			});
		}
	], function(err) {
		if(err){
			console.log(err);
			callback(null);
			return;
		}
		callback(roomData);
	});	
}

ChatRemote.prototype.saveToken = function(uid, token, callback) {
	userDao.saveToken(uid,token,function(err, data) {
		callback(data);
	});
}

ChatRemote.prototype.join = function(uid, roomname, callback) {
	roomDao.join(uid,roomname,function(err, data) {
		callback(data);
	});
}

ChatRemote.prototype.exit = function(uid, roomname,callback) {
	roomDao.exit(uid,roomname,function(err, data) {
		callback(data);
	});
}
